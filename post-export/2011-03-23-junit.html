--- 
name: junit
layout: post
title: !binary |
  0J3QvtCy0LjQvdC60LggSlVuaXQuINCa0LDRgtC10LPQvtGA0LjQuA==

time: 2011-03-23 13:38:00 +02:00
---
<div><div>В последнее время во всех проектах где я принимаю участие не обходится без автоматизированного тестирования. Везде есть unit тесты, плюс разработку часто сопровождают попытки покрыть код тестами на Selenium.</div><div><span class="Apple-style-span"><br /></span></div><div><span class="Apple-style-span">Первый вопрос который стоит перед командой при написании автоматизированных тестов -- как мы будем запускать тесты? Точнее -- какой фреймворк для тестирования нам выбрать? Если мы программируем на Java, выбор не велик. JUnit или TestNG.</span></div><div><span class="Apple-style-span"><br /></span></div><div><span class="Apple-style-span">Помню, когда мы начинали заниматься функциональными тестами на нашем последнем проекте, мы долго решали что же выбрать. Победил TestNG. Легкость создания test suit'a, возможность группировать тесты и запускать их параллельно -- вот что определило наш выбор. В тот момент я подписался на интересные блоги и рассылки связанные с тестированием, и через некоторое время обнаружил, что JUnit активно развивается и догоняет TestNG по функциональности, при этом превосходит его в продуманности API.</span></div><div><span class="Apple-style-span"><br /></span></div><div><span class="Apple-style-span">Так, в JUnit начиная с версии 4.8 появился механизм для метки и группировки тестов, под названием Categories. </span></div><div><span class="Apple-style-span">Процесс группировки тестов в JUnit до появления категорий можно стравнить с организацией писем в Microsoft Outlook. Мы можем группировать тест методы в классы, а классы в пакеты.</span></div><div>Теперь, с помощью категорий, группировка тестов похожа на группировку писем в GMail.</div><div><span class="Apple-style-span"><br /></span></div><div><span class="Apple-style-span">Представляются категории в виде java интерфейсов, что дает приемущества по сравнению с группами в TestNG. В отличии от строковых констант коими являются группы, мы можем переименовывать категории в IDE, </span> плюс есть возможность построить йерархии категорий, что дает нам гибкость в организации тестов.</div><div><span class="Apple-style-span"><br /></span></div><div><span class="Apple-style-span">Предположим, что у нас есть 4 категории: SmokeTest говорит что наш тест - смоук тест, BrokenTest показывает, что тест тестирует поломанный функционал, а с помощью FastTest и SlowTest мы помечаем тесты по времени выполнения.  </span></div><div><span class="Apple-style-span"><br /></span></div><div><i>public interface SmokeTest {}</i></div><div><br /></div><div><i>public interface BrokenTest {}</i></div><div><br /></div><div><i>public interface FastTest {}</i></div><div><br /></div><div><i>public interface SlowTest {}</i></div><div><br /></div><div><span class="Apple-style-span">Допустим у нас есть два тест класса с помеченными методами:</span></div><div><span class="Apple-style-span"><br /></span></div><div><i>@Category(SmokeTest.class)</i></div><div><span class="Apple-style-span"><i>public class SomeSmokeTests {</i></span></div><div><span class="Apple-style-span"><i>    </i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space: pre; "> </span>@Test</i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space: pre; "> </span>@Category(FastTest.class)</i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space: pre; "> </span>public void someFastTest() {</i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space: pre; ">  </span>// test something</i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space: pre; "> </span>}</i></span></div><div><br /></div><div><span class="Apple-style-span">    </span></div><div><span class="Apple-style-span"><span class="Apple-tab-span" style="white-space:pre"> </span>@Test</span></div><div><span class="Apple-style-span"><span class="Apple-tab-span" style="white-space:pre"> </span>@Category(SlowTest.class)</span></div><div><span class="Apple-style-span"><span class="Apple-tab-span" style="white-space:pre"> </span>public void someReallySlowTest() {</span></div><div><span class="Apple-style-span">    <span class="Apple-tab-span" style="white-space:pre">  </span>// test something    </span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space:pre"> </span>}</i></span></div><div><span class="Apple-style-span"><i>}</i></span></div><div><br /></div><div><i>public class SomeTestCase {</i></div><div><span class="Apple-style-span"><i><br /></i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space:pre"> </span>@Test</i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space:pre"> </span>@Category({SmokeTest.class, FastTest.class})</i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space:pre"> </span>public void fastSmokeTest() {</i></span></div><div><span class="Apple-style-span"><i>    <span class="Apple-tab-span"><span class="Apple-tab-span" style="white-space: pre; ">  </span></span>// test something</i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space:pre"> </span>}</i></span></div><div><span class="Apple-style-span"><i>    </i></span></div><div><span class="Apple-style-span"><i><br /></i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space:pre"> </span>@Test</i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space:pre"> </span>@Category({SmokeTest.class, FastTest.class, BrokenTest.class})</i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space:pre"> </span>public void fastBrokenSmokeTest() {</i></span></div><div><span class="Apple-style-span"><i>    <span class="Apple-tab-span" style="white-space:pre">  </span>// test something</i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space:pre"> </span>}</i></span></div><div><span class="Apple-style-span"><i>    </i></span></div><div><span class="Apple-style-span"><span class="Apple-tab-span" style="white-space:pre"><i> </i></span></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space:pre"></span><span class="Apple-tab-span" style="white-space:pre"> </span>@Test</i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space:pre"> </span>@Category({SmokeTest.class, SlowTest.class})</i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space:pre"> </span>public void slowSmokeTest() {</i></span></div><div><span class="Apple-style-span"><i>    <span class="Apple-tab-span" style="white-space:pre">   </span>// test something</i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space:pre"> </span>}</i></span></div><div><span class="Apple-style-span"><i><br /></i></span></div><div><span class="Apple-style-span"><i>}</i></span></div><div><br /></div><div><span class="Apple-style-span">С помощью категорий мы можем построить test suite, который будет запускать быстрые smoke тесты с работающим функционалом:</span></div><div><br /></div><div><i>@RunWith(Categories.class)</i></div><div><span class="Apple-style-span"><i>@IncludeCategory(SmokeTest.class, FastTest.class)</i></span></div><div><span class="Apple-style-span"><i>@ExcludeCategory(BrokenTest.class)</i></span></div><div><span class="Apple-style-span"><i>@SuiteClasses(SomeSmokeTests.class, SomeTestCase.class)</i></span></div><div><span class="Apple-style-span"><i>public class RunFastSmokeTestCases {}</i></span></div><div><br /></div><div>Правда, с увеличением количества классов в suite, конфигурация получаеться громоздкой, а куча аннотаций никак не добавляет читабельности коду.</div><div><br /></div><div><span class="Apple-style-span">К счастью эта проблема решается с помощью библиотеки <a href="http://github.com/mairbek/junit-suite-configurator">junit-suite-configurator</a>. Так выглядит конфигурация эта же конфигурация написанная с ее помощью:</span></div><div><span class="Apple-style-span"><br /></span></div><div><i>@RunWith(Suite.Configuration.class)</i></div><div><span class="Apple-style-span"><i>public class Suite {</i></span></div><div><span class="Apple-style-span"><i><br /></i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space:pre"> </span>public static class Configuration extends AbstractConfiguration {</i></span></div><div><span class="Apple-style-span"><i><br /></i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space:pre"><span class="Apple-tab-span" style="white-space: pre; "> </span> </span>public Configuration(Class<!--?--> testClass) {</i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space:pre">   </span>super(testClass);</i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space:pre">  </span>}</i></span></div><div><span class="Apple-style-span"><i><br /></i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space:pre"><span class="Apple-tab-span" style="white-space: pre; "> </span> </span>@Override</i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space:pre">  </span>protected void configure() {</i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space:pre">   </span>run(classes(SomeSmokeTests.class, SomeTestCase.class))</i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space:pre">    </span>.filter(includeCategories(SmokeTest.class, FastTest.class))</i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space:pre">    </span>.filter(excludeCategories(BrokenTest.class))</i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space:pre"><span class="Apple-tab-span" style="white-space: pre; "> </span>   </span>.applyRule(new Rule1())</i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space:pre">   </span>).invokeIn(singleThread());</i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space:pre">  </span>}</i></span></div><div><span class="Apple-style-span"><i><span class="Apple-tab-span" style="white-space:pre"> </span>}</i></span></div><div><span class="Apple-style-span"><i>}</i></span></div><div><br /></div></div><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/4802694757293965538-2810370113431005523?l=khadikov.blogspot.com' alt='' /></div>
